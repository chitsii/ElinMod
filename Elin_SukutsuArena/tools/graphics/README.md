# キャラチップ・ポートレート作成ツール

Elin MOD用のキャラクター画像を自動処理するPythonツール群です。

## ツール一覧

| ファイル | 用途 |
|---------|------|
| `process_graphics.py` | メインツール。クロマキー背景除去 + リサイズ |
| `resize_images.py` | 単純リサイズのみ（背景処理なし） |
| `manage_images.py` | ナレーター用透明画像作成 + 48x48リサイズ |

## 使い方

### 1. 元画像の準備

#### キャラチップ（スプライト）
- **配置先**: `Texture/` フォルダ
- **ファイル名**: `{キャラID}.png` （例: `sukutsu_receptionist.png`）
- **背景色**: マゼンタ (`#FF00FF`) で塗りつぶす

#### ポートレート
- **配置先**: `Portrait/` フォルダ
- **ファイル名**: `{キャラID}.png` （例: `sukutsu_receptionist.png`）
- **背景色**: マゼンタ (`#FF00FF`) で塗りつぶす

### 2. ツール実行

```bash
cd tools/graphics
python process_graphics.py
```

### 3. 出力結果

ツールは元画像を直接上書きし、以下の形式に変換します：

| 種類 | 最終サイズ | 処理方法 |
|------|-----------|----------|
| Texture（キャラチップ） | 128x128 px | NEAREST（ピクセルアート向け） |
| Portrait（ポートレート） | 240x320 px | LANCZOS（滑らか） |

## Elin画像形式の仕様

### キャラチップ（Texture）

```
┌─────────────────────────┐
│                         │
│    (透明余白)           │
│                         │
│   ┌───────────────┐     │
│   │               │     │
│   │  キャラクター  │     │  128x128 キャンバス
│   │   (83x104)    │     │
│   │               │     │
│   └───────────────┘     │
│        (中央下配置)      │
└─────────────────────────┘
```

- **キャンバスサイズ**: 128x128 px（必須）
- **キャラクターサイズ**: 約83x104 px（アスペクト比維持）
- **配置**: 中央下（下端から4px余白）
- **背景**: 完全透明

### ポートレート（Portrait）

- **サイズ**: 240x320 px（必須）
- **配置**: 中央
- **背景**: 完全透明

## クロマキー処理について

### 背景色の指定
- **推奨色**: マゼンタ `RGB(255, 0, 255)` = `#FF00FF`
- **許容範囲**: 各RGB成分で ±50 の誤差を許容

### なぜマゼンタ？
- キャラクターに使われにくい色
- 多くの画像編集ソフトでサポート
- 視認性が高く作業しやすい

### 注意事項
1. キャラクターにマゼンタ系の色（紫・ピンク）がある場合、誤って透過される可能性あり
2. その場合は `COLOR_TOLERANCE` を小さくするか、別の背景色を使用
3. アンチエイリアスが強い画像は境界にマゼンタが残る場合あり

## 元画像の作成ガイドライン

### 推奨サイズ（リサイズ前）
- **キャラチップ**: 256x320 px 以上（大きめで作成し縮小）
- **ポートレート**: 480x640 px 以上

### 画像作成のコツ
1. 背景を純粋なマゼンタ `#FF00FF` で塗りつぶす
2. キャラクターの境界はハードエッジ（アンチエイリアス弱め）推奨
3. キャラチップはピクセルアート風に作成すると縮小後も綺麗

### NG例
- 背景がグラデーション → クロマキー処理できない
- 背景が白や黒 → キャラの一部も消える可能性
- JPG形式 → 圧縮ノイズでクロマキーが正しく動作しない

## ファイル命名規則

```
Texture/{キャラID}.png
Portrait/{キャラID}.png
```

**キャラID例**:
- `sukutsu_receptionist` → リリィ
- `sukutsu_arena_master` → バルガス
- `sukutsu_grand_master` → グランドマスター

`create_chara_excel.py` で定義した `id` フィールドと一致させること。

## トラブルシューティング

### 背景が透過されない
- 背景色がマゼンタ `#FF00FF` か確認
- `COLOR_TOLERANCE` の値を上げる（デフォルト: 50）

### キャラの一部が透過される
- キャラクターにマゼンタ系の色が含まれている
- `COLOR_TOLERANCE` の値を下げる

### 画像がぼやける
- 元画像の解像度が低い
- より大きなサイズで作成してから処理する

### エッジがギザギザになる
- キャラチップはNEAREST法（ピクセルアート向け）で縮小されるため正常
- ぼかしたい場合は `process_graphics.py` の `NEAREST` を `LANCZOS` に変更

## 依存関係

```bash
pip install Pillow
```

## 関連ファイル

- `tools/builder/create_chara_excel.py` - キャラクター定義（`_idRenderData: '@chara'` 設定）
- `Texture/` - キャラチップ出力先
- `Portrait/` - ポートレート出力先
