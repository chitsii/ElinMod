# Elin Item Relocator

持ち物や地面のアイテムを検索し、指定コンテナへ移動します。
柔軟な検索条件でアイテムを集めることができます。
例えば...
- 魔法強化40以上の装備
- 高品質以下の装備
- 盗品
- 呪われたアイテム
- 重量15s以上の死体
- ダークマター素材のジャンク
- 上記の条件を複合(AND / OR)した条件 etc...

集められる数はコンテナの容量と最大値100個のいずれかに制限されます。


## 使い方

1. ゲーム内で任意のコンテナ（箱、タンス、冷蔵庫など）を開く
2. ウィンドウ右部に追加される「★」ボタンを押すと、検索UIに移ります。
3. 左側のウィンドウで検索条件を作ると、右側にリアルタイムに検索結果がプレビューされます
   検索結果の各アイテムにマウスオーバーするとツールチップが表示されます。
   アイテムをクリックすると、個別にアイテムを移動します。
   「全て転送」ボタンを押すと条件に合うアイテムが一括で移動します（個数はコンテナの容量に制限されます）
   ※プレビューの軽快さを優先して、表示数100件、検索ヒット数を2000件までに制限しているため、該当アイテムが2000件を超えるとトップ100件のオーダーが正確でない可能性があります。が、「全て転送」実行時にはこの制限はなく、条件に合うすべてのアイテムが対象になります。


## 主な機能

- **コンテナのUI統合**: コンテナのウィンドウ右に「★」ボタンを追加
- **条件付け検索**:
  - **テキスト/タグ**: 自由記述で名前やタグの部分一致によるフィルタ
  - **カテゴリ**: アイテムカテゴリによるフィルタ（例: `剣`, `素材`）
  - **エンチャント**: エンチャント種別や強度（Power）による比較（`>=10` など）
  - **レアリティ**: 特別・神器・奇跡・高品質などのレアリティ
  - **品質**: 品質値の数値の範囲
  - **素材**: アイテム素材
  - **祝福**: 祝福・呪い・堕落など状態
  - **盗品**: 盗品フラグの有無
- **ソート**:
  - **見つけた順**: 見つけた順(Default)
  - **価値**: アイテムの価値を基準にソート（高い順/安い順）
  - **エンチャント強度**: 検索対象エンチャントの強度合計値でソート（強い順/弱い順）
  - **総重量**: スタックの総重量でソート（重い順/軽い順）
  - **単体重量**: 1個あたりの重量を基準にソート（重い順/軽い順）
- **検索範囲**:
  - **持ち物**: プレイヤーの所持品を対象。装備中のアイテム、ツールベルトにあるアイテム、大事なもの指定されたアイテムは自動的に除外されます。
  - **地面**: 現在のマップ（足元）にあるアイテムも回収対象に含める（設置済みの家具は除外）
  - **持ち物+地面**: 上記両方を対象とします。
- **リアルタイムプレビュー**: 
  - 検索範囲を変更したり、フィルタを追加したりすると即座に更新されます
  - プレビュー画面から直接アイテムのツールチップを確認できます

## アンインストール
いつでも導入・削除が可能

## 設定ファイル
保存した条件のプリセットなどは外部JSONとして保存されています。
`%USERPROFILE%\AppData\LocalLow\Lafrontier\Elin\Save\Elin_ItemRelocator_Data.json`


## 検索・フィルタ仕様の詳細

### 除外ルール（自動的に検索対象外になるもの）
以下の条件に当てはまるアイテムは、フィルタ条件に関わらず常に無視されます。
- **大事なもの**: `Thing.c_isImportant` が有効なアイテム
- **装備中**: `Thing.isEquipped` が有効なアイテム
- **持てないもの**: `Thing.trait.CanBeHeld` が無効なアイテム
- **設置物**: `Thing.placeState` が `Info.State.installed` のアイテム
    - ※ただし、スコープが「地面」の時、設置された**コンテナの中身**は検索対象になります。
- **ホットバー**: 設定で「ツールベルト除外」がONの場合、ホットバーに登録されているアイテムへの参照を持つものは除外されます。
- **移動先**: 移動先のコンテナ自体、またはその中身に含まれるアイテム（再帰防止）。

### フィルタリング条件の技術仕様
各フィルタは内部的に以下のフールド/値を参照して判定しています。

- **カテゴリ** (`Thing.category`)
    - `Thing.category.IsChildOf(id)` を使用して、指定カテゴリまたはそのサブカテゴリに含まれるかを判定します。
    - 除外指定（Not）も可能です。
- **テキスト** (`Thing.Name`, `Thing.source.GetName()`)
    - アイテムの表示名に対して部分一致検索を行います
    - 大文字・小文字は区別しません
- **エンチャント** (`Thing.enc`/`Thing.elements`)
    - 指定されたエンチャント（Element ID）の値（Power）と比較します。
    - 比較演算子（`>=`, `<=`, `>`, `<`, `=`, `!=`）をサポート。
    - UI上では汎用・武器・防具などのカテゴリから選択可能です。
- **品質** (`Thing.encLV`)
    - `int` 型の品質値と比較します
    - 例: `>=3` は `Thing.encLV >= 3` を意味します。
- **レアリティ** (`Thing.rarity`)
    - `Rarity` 列挙型の整数値（Legendary, Mythicalなど）と比較します。
- **重量** (`Thing.SelfWeight`)
    - スタック重量ではなく、アイテム1個あたりの単体重量（Unit Weight）と比較します。
    - 値は内部整数（`1000` = `1.0s`）として扱われます。
- **素材** (`Thing.material`)
    - `Thing.material.alias` (例: `adamantium`) または `Thing.material.id` との一致を判定します。
- **祝福・呪い** (`Thing.bless`)
    - `Thing` クラスの内部非公開フィールド `bless` の値を直接参照
    - 値の定義: `1` (祝福), `0` (通常), `-1` (呪い), `-2` (堕落)
- **盗品** (`Thing.isStolen`)
    - `bool` フラグの一致を判定します。

